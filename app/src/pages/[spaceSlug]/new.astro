---
/**
 * This docuemnt is a empty placeholder to create a new doc without saving one.
 */
import SpaceLayout from "../../layouts/SpaceLayout.astro";
import DocumentContent from "../../components/DocumentContent.vue";
import { getSpaceBySlug } from "../../db/spaces.ts";
import Canvas from "~/src/canvas/Canvas.vue";
import { twMerge } from "tailwind-merge";
import TitleEditor from "~/src/components/TitleEditor.vue";
import DocumentActions from "~/src/components/DocumentActions.vue";
import DocumentProperties from "~/src/components/DocumentProperties.vue";
import CommentManager from "~/src/components/CommentManager.vue";

if (!Astro.locals.session) {
  return Astro.redirect("/login");
}

const { spaceSlug } = Astro.params;
if (!spaceSlug) {
  return Astro.redirect("/");
}

const space = await getSpaceBySlug(spaceSlug);

if (!space) {
  return new Response(null, {
    status: 404,
    statusText: "Space not found",
  });
}

const type = Astro.url.searchParams.get("type") || "document";
const title = type === "canvas" ? "Untitled Canvas" : "Untitled Document";
---

<SpaceLayout title={`${title} - ${space.name} - Wiki`}>
    <div
      class={twMerge(
        "space-y-6 mx-auto h-full flex flex-col"
      )}
     >
      <!-- Document Header -->
      <div class={twMerge(
        type === 'canvas' ? 'absolute top-xs right-0 left-0 lg:left-(--sidebar-width) z-10' : 'pt-s mb-xl'
      )}>
        <div class="flex gap-6 lg:gap-4 justify-between flex-col-reverse lg:flex-row print:px-0 px-xs lg:px-xl mt-xl">
          <div>
            <div class="flex items-start justify-between">
              <TitleEditor client:load initialEditMode={true} title={title} documentId={undefined} />
            </div>
          </div>

          <DocumentActions documentId={undefined} title={title} readonly={false} client:load />
        </div>

        <div class="print:px-0 px-xs lg:px-xl mt-xs">
          <DocumentProperties client:load documentId={undefined} initialProperties={{}} />
        </div>
      </div>

      <!-- Main Content -->
      <div
        class={twMerge(
          'max-w-none text-neutral-700 h-full',
          type !== 'canvas' && "pb-20 print:px-0 px-xs lg:px-xl"
        )}
      >
        <DocumentContent
			client:load
			spaceId={space.id}
			documentType={type}
			initialEditMode={true}
		/>

	    <div class="h-full">
      		{type === "canvas" ? (
         			<Canvas
            client:only="vue"
                spaceId={space.id}
         			/>
      		) : (
            <div>
        		  <editor-content></editor-content>
          		</div>
            )}
		</div>
      </div>
    </div>
</SpaceLayout>
